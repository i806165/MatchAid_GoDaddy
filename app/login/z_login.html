<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MatchAid • Login</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            /* ---  MatchAid Tokens (Canonical) --- */
            /* Brand */
            --brandPrimary: #07432A;
            --brandSecondary: #3F7652;
            --segmentSelectedBg: #CDB278;
            --onBrandText: #FFFFFF;

            /* Surfaces */
            --appBg: #FFFFFF;
            --surface: #FFFFFF;
            --surfaceRaised: #FFFFFF;

            /* Inks (3-inks rule) */
            --onSurfaceText: #111111;
            --onSurfaceMutedText: rgba(17, 17, 17, .62);
            --onSurfaceSoftText: rgba(17, 17, 17, .45);

            /* Borders / dividers */
            --border: rgba(0, 0, 0, .12);
            --divider: rgba(0, 0, 0, .10);
            --controlBorder: rgba(0, 0, 0, .15);

            /* Status */
            --danger: #c62828;
            --warn: #f6d365;
            --success: #0aa45c;
            --statusSuccessBg: var(--success);
            --statusSuccessText: #ffffff;
            --statusWarnBg: var(--warn);
            --statusWarnText: #111111;
            --statusErrorBg: var(--danger);
            --statusErrorText: #ffffff;
            --statusInfoBg: var(--brandSecondary);
            --statusInfoText: #ffffff;

            /* Layout */
            --pagePad: 12px;
            --cardPad: 12px;
            --cardRadius: 14px;
            --rowPadX: 12px;
            --rowPadTop: 10px;
            /* padding ABOVE drives rhythm */
            --rowPadBottom: 8px;

            /* Controls */
            --controlsBg: color-mix(in srgb, var(--brandSecondary) 6%, var(--appBg));
            --controlH: 36px;
            --controlRadius: 14px;
            --chipH: 36px;
            --chipRadius: 14px;

            /* Footer */
            --footerBarH: 30px;
            --footerTopLine: rgba(0, 0, 0, .22);
            --footerShadow: 0 -8px 18px rgba(0, 0, 0, .10);

            /* Typography (Montserrat) */
            --fs-title: 18px;
            --fs-subtitle: 15px;
            --fs-section: 16px;
            --fs-body: 13px;
            --fs-label: 13px;
            --fs-input: 13px;
            --fs-caption: 11px;
            --fs-micro: 10px;

            --fw-regular: 400;
            --fw-medium: 500;
            --fw-semibold: 600;

            --lh-tight: 1.15;
            --lh-normal: 1.35;

            /* Z scale */
            --zBase: 0;
            --zHeader: 100;
            --zControls: 105;
            --zFooter: 110;

            /* Aliases */
            --bodyPad: var(--pagePad);
            --footerHeight: var(--footerBarH);
            --focusRing: rgba(0, 120, 212, 0.35);
            --focusRingW: 3px;
        }

        @media (max-width: 520px) {
            :root {
                --pagePad: 10px;
                --controlH: 34px;
                --chipH: 34px;
                --footerBarH: 28px;

                --fs-title: 17px;
                --fs-subtitle: 14px;
                --fs-section: 15px;
                --fs-body: 13px;
                --fs-label: 13px;
                --fs-input: 13px;
                --fs-caption: 11px;
                --fs-micro: 10px;
            }
        }

        html,
        body {
            height: 100%;
        }

        body {
            margin: 0;
            font-family: Montserrat, Arial, sans-serif;
            background: var(--appBg);
            color: var(--onSurfaceText);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Text roles */
        .text--title {
            font-size: var(--fs-title);
            line-height: var(--lh-tight);
            font-weight: var(--fw-semibold);
        }

        .text--subtitle {
            font-size: var(--fs-subtitle);
            line-height: var(--lh-normal);
            font-weight: var(--fw-medium);
        }

        .text--section {
            font-size: var(--fs-section);
            line-height: var(--lh-tight);
            font-weight: var(--fw-semibold);
        }

        .text--body {
            font-size: var(--fs-body);
            line-height: var(--lh-normal);
            font-weight: var(--fw-regular);
        }

        .text--label {
            font-size: var(--fs-label);
            line-height: var(--lh-tight);
            font-weight: var(--fw-medium);
        }

        .text--input {
            font-size: var(--fs-input);
            line-height: var(--lh-tight);
            font-weight: var(--fw-regular);
        }

        .text--caption {
            font-size: var(--fs-caption);
            line-height: var(--lh-normal);
            font-weight: var(--fw-regular);
        }

        .text--micro {
            font-size: var(--fs-micro);
            line-height: var(--lh-tight);
            font-weight: var(--fw-regular);
        }

        /* Ink helpers */
        .ink--brand {
            color: var(--onBrandText);
        }

        .ink--default {
            color: var(--onSurfaceText);
        }

        .ink--muted {
            color: var(--onSurfaceMutedText);
        }

        .hidden {
            display: none !important;
        }

        .nowrap {
            white-space: nowrap;
        }

        /* Page chrome (header/controls/body/footer) */
        .pageHeader {
            position: relative;
            z-index: var(--zHeader);
            background: var(--brandPrimary);
            border-bottom: 1px solid var(--border);
            padding: 10px var(--pagePad);
        }

        .hdrLeft {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            /* equal flexible sides + centered middle */
            align-items: center;
            gap: 10px;
            min-width: 0;
        }

        .hdrTitleWrap {
            display: flex;
            flex-direction: column;
            gap: 2px;
            min-width: 0;
            flex: 1 1 auto;
            align-items: center;
            text-align: center;

            grid-column: 2;
            /* middle column */
            justify-self: center;
        }


        .hdrTitle,
        .hdrSub {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .hdrRight {
            display: flex;
            align-items: center;
            gap: 8px;
            justify-self: end;
            /* right column */
        }

        .hdrLeftSlot {
            justify-self: start;
            /* left column */
            /* placeholder to keep header layout stable */
            height: var(--controlH);
            flex: 0 0 auto;
        }


        .controls {
            position: relative;
            z-index: var(--zControls);
            background: var(--controlsBg);
            border-bottom: 1px solid var(--divider);
            padding: 8px var(--pagePad);
        }

        .controlsRow {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            min-width: 0;
            flex-wrap: wrap;
        }

        .content {
            flex: 1 1 auto;
            min-height: 0;
            overflow: auto;
            padding: var(--bodyPad);
            padding-bottom: var(--bodyPad);
        }

        .footerBar {
            z-index: var(--zFooter);
            height: var(--footerHeight);
            display: flex;
            align-items: center;
            padding: 0 var(--pagePad);
            background: var(--surface);
            border-top: 1px solid var(--footerTopLine);
            box-shadow: var(--footerShadow);
            font-size: var(--fs-caption);
            color: var(--onSurfaceText);
        }

        .footerBar.is-success {
            background: var(--statusSuccessBg);
            color: var(--statusSuccessText);
        }

        .footerBar.is-warn {
            background: var(--statusWarnBg);
            color: var(--statusWarnText);
        }

        .footerBar.is-error {
            background: var(--statusErrorBg);
            color: var(--statusErrorText);
        }

        .footerBar.is-info {
            background: var(--statusInfoBg);
            color: var(--statusInfoText);
        }

        /* Cards / layout */
        .card {
            background: var(--surfaceRaised);
            border: 1px solid var(--border);
            border-radius: var(--cardRadius);
            padding: var(--cardPad);
            box-shadow: 0 8px 18px rgba(0, 0, 0, .06);
            max-width: 820px;
            margin: 0 auto;
        }

        .cardHdr {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 10px;
            margin-bottom: 10px;
        }

        .formGrid {
            display: grid;
            grid-template-columns: 160px 1fr;
            gap: 10px 10px;
            align-items: center;
        }

        @media (max-width: 520px) {
            .formGrid {
                grid-template-columns: 1fr;
            }

            .rowLabel {
                margin-top: 6px;
            }
        }

        .rowLabel {
            color: var(--onSurfaceMutedText);
        }

        .rowInline {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .actionsRow {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 12px;
            flex-wrap: nowrap;
        }

        .actionsRow .btn {
            min-width: 140px;
        }


        /* Controls */
        .ctrl {
            height: var(--controlH);
            border-radius: var(--controlRadius);
            border: 1px solid var(--controlBorder);
            background: var(--surface);
            color: var(--onSurfaceText);
            padding: 0 12px;
            font-size: var(--fs-input);
            line-height: var(--lh-tight);
            outline: none;
            width: 100%;
            box-sizing: border-box;
        }

        .ctrl:focus-visible {
            box-shadow: 0 0 0 var(--focusRingW) var(--focusRing);
        }

        .ctrl:disabled {
            opacity: .6;
            cursor: not-allowed;
        }

        /* Password field: industry-standard eye toggle inside input */
        .pwdWrap {
            position: relative;
            width: 100%;
        }

        .pwdWrap .ctrl {
            padding-right: 46px;
            /* space for eye button */
        }

        .pwdToggle {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            height: 30px;
            width: 34px;
            border: none;
            background: transparent;
            color: var(--onSurfaceMutedText);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
        }

        .pwdToggle:focus-visible {
            outline: none;
            box-shadow: 0 0 0 var(--focusRingW) var(--focusRing);
        }

        .pwdIco {
            width: 18px;
            height: 18px;
            fill: currentColor;
        }


        /* Buttons (keep small set; tokens only) */
        .btn {
            height: var(--controlH);
            padding: 0 12px;
            border-radius: var(--controlRadius);
            border: 1px solid var(--controlBorder);
            background: var(--surface);
            color: var(--onSurfaceText);
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: var(--fs-label);
            font-weight: var(--fw-medium);
            line-height: var(--lh-tight);
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .btn:focus-visible {
            outline: none;
            box-shadow: 0 0 0 var(--focusRingW) var(--focusRing);
        }

        .btn:disabled {
            opacity: .55;
            cursor: not-allowed;
        }

        .btn--hdr {
            background: var(--appBg);
            color: var(--onSurfaceText);
            border-color: var(--controlBorder);
        }

        .btn--primary {
            background: var(--brandSecondary);
            border-color: var(--brandSecondary);
            color: var(--onBrandText);
        }

        .btn--ghost {
            background: transparent;
            border-color: var(--controlBorder);
            color: var(--onSurfaceText);
        }

        /* Inline status */
        .msg {
            padding: 10px 12px;
            border-radius: 12px;
            border: 1px solid var(--divider);
            background: color-mix(in srgb, var(--danger) 12%, var(--surface));
            color: var(--onSurfaceText);
            margin-top: 10px;
        }

        .msg--error {
            border-color: color-mix(in srgb, var(--danger) 45%, var(--divider));
            background: color-mix(in srgb, var(--danger) 14%, var(--surface));
        }

        /* Tiny spinner (optional) */
        .spin {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            border: 2px solid color-mix(in srgb, var(--onSurfaceText) 18%, transparent);
            border-top-color: var(--onSurfaceText);
            animation: spin 0.85s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .hintLine {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        @media (max-width: 520px) {
            .actionsRow {
                width: 100%;
            }

            .actionsRow .btn {
                flex: 1 1 0;
                /* equal widths */
                min-width: 0;
                /* allows shrink instead of wrapping */
            }
        }
    </style>
</head>

<body>
    <header class="pageHeader" role="banner">
        <div class="hdrLeft">
            <div class="hdrLeftSlot" aria-hidden="true"></div>

            <div class="hdrTitleWrap">
                <div id="title" class="hdrTitle text--title ink--brand">MatchAid Login</div>
                <div id="subtitle" class="hdrSub text--subtitle ink--brand">Sign in to continue</div>
            </div>

            <div class="hdrRight" aria-hidden="true"></div>
        </div>
    </header>

    <div class="controls" id="controls">
        <div class="controlsRow">
        </div>
    </div>

    <main class="content" id="content" role="main">
        <section class="card" aria-label="MatchAid login form">
            <div class="cardHdr">
                <div class="text--section ink--default">Credentials</div>
                <div id="busyBadge" class="hintLine text--caption ink--muted hidden" aria-live="polite">
                    <span class="spin" aria-hidden="true"></span>
                    <span>Working…</span>
                </div>
            </div>

            <div class="formGrid" aria-label="Login fields">
                <div class="rowLabel text--label">Email or User-ID</div>
                <input id="inputUserId" class="ctrl" type="text" autocomplete="username" inputmode="email" />

                <div class="rowLabel text--label">Password</div>
                <div class="pwdWrap">
                    <input id="inputPassword" class="ctrl" type="password" autocomplete="current-password"
                        aria-describedby="pwdToggleHint" />
                    <button id="btnPwdToggle" class="pwdToggle" type="button" aria-label="Show password"
                        title="Show password">
                        <!-- eye -->
                        <svg id="icoEye" class="pwdIco" viewBox="0 0 24 24" aria-hidden="true">
                            <path
                                d="M12 5c-5.05 0-9.27 3.11-11 7 1.73 3.89 5.95 7 11 7s9.27-3.11 11-7c-1.73-3.89-5.95-7-11-7Zm0 11a4 4 0 1 1 0-8 4 4 0 0 1 0 8Zm0-2a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z" />
                        </svg>
                        <!-- eye-off -->
                        <svg id="icoEyeOff" class="pwdIco hidden" viewBox="0 0 24 24" aria-hidden="true">
                            <path
                                d="M2.1 3.51 3.51 2.1l18.38 18.38-1.41 1.41-2.06-2.06A11.93 11.93 0 0 1 12 20C6.95 20 2.73 16.89 1 13c.88-1.98 2.29-3.7 4.06-4.99L2.1 3.51Zm5.7 5.7A3.99 3.99 0 0 0 8 12a4 4 0 0 0 6.79 2.79l-1.51-1.51A2 2 0 0 1 10.72 10.72L7.8 7.8ZM12 6c5.05 0 9.27 3.11 11 7-.68 1.52-1.63 2.88-2.79 4.01l-1.43-1.43A10.45 10.45 0 0 0 21 13c-1.73-3.89-5.95-7-11-7-1.4 0-2.74.24-3.99.68L4.64 5.31A12.85 12.85 0 0 1 12 6Z" />
                        </svg>
                    </button>
                    <span id="pwdToggleHint" class="hidden">Toggle password visibility</span>
                </div>
            </div>

            <div id="msgError" class="msg msg--error text--caption hidden" role="alert"></div>

            <div class="actionsRow">
                <button id="btnCancel" class="btn btn--ghost" type="button">Cancel</button>
                <button id="btnLogin" class="btn btn--primary" type="button">Log In</button>
            </div>
        </section>
    </main>

    <footer id="footerBar" class="footerBar" role="status" aria-live="polite">
        <div id="msgStatus" class="text--caption"></div>
    </footer>

    <script>
        // -------------------------
        // Standalone GoDaddy wiring (replaces Wix postMessage)
        // -------------------------
        const state = { busy: false };
        const BOOT = (window.MA_BOOT && typeof window.MA_BOOT === "object") ? window.MA_BOOT : {};
        const ROUTES = (BOOT.routes && typeof BOOT.routes === "object") ? BOOT.routes : {};

        function resolveRoute(actionKey) {
        const key = String(actionKey || "").trim();
        if (key && ROUTES[key]) return ROUTES[key];
        if (ROUTES.home) return ROUTES.home;
        return "/";
        }

        // Adjust if you host under a subfolder (e.g., /matchaid/...)
        const API = {
            login: "/api/auth/login.php",
            contextUser: "/services/context/service_ContextUser.php",   // if you expose it (recommended)
            logout: "/api/auth/logout.php"                     // create if you don't have it yet
        };

        const $ = (id) => document.getElementById(id);

        function setBusy(on) {
            state.busy = !!on;
            $("busyBadge").classList.toggle("hidden", !state.busy);
            $("btnLogin").disabled = state.busy;
            $("btnCancel").disabled = state.busy;
            $("inputUserId").disabled = state.busy;
            $("inputPassword").disabled = state.busy;
            $("btnPwdToggle").disabled = state.busy;
        }

        function setStatus(message, level) {
            const bar = $("footerBar");
            const el = $("msgStatus");
            if (el) el.textContent = message || "";

            bar.classList.remove("is-success", "is-warn", "is-error", "is-info");
            if (level === "success") bar.classList.add("is-success");
            else if (level === "warn") bar.classList.add("is-warn");
            else if (level === "error") bar.classList.add("is-error");
            else if (level === "info") bar.classList.add("is-info");
        }

        function showError(msg) {
            $("msgError").textContent = msg || "";
            $("msgError").classList.toggle("hidden", !msg);
            if (msg) setStatus(msg, "warn");
        }

        function validate() {
            const rawUserId = String($("inputUserId").value || "").trim();
            const password = String($("inputPassword").value || "").trim();

            // Same rules you already use:
            const isEmail = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(rawUserId);
            const isNumericId = /^\d+$/.test(rawUserId);

            if (!rawUserId) return { ok: false, msg: "Please enter a valid Email or User-ID." };
            if (!isEmail && !isNumericId) return { ok: false, msg: "Please enter a valid Email or User-ID." };
            if (!password) return { ok: false, msg: "Please enter a Password." };

            return { ok: true, userId: rawUserId, password };
        }

        async function apiPostJson(url, bodyObj) {
            const res = await fetch(url, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                credentials: "same-origin", // send/receive PHP session cookie
                body: JSON.stringify(bodyObj || {})
            });

            // Allow endpoints to return 200/4xx with JSON
            const text = await res.text();
            let json = {};
            try { json = JSON.parse(text || "{}"); } catch (_) { }

            if (!res.ok && !json.ok) {
                // Prefer server message if present
                const msg = json.message || `Request failed (${res.status})`;
                return { ok: false, message: msg, status: res.status, raw: json };
            }
            return json;
        }

        async function initFromServer() {
            // Optional but nice: prefill storedEmail + subtitle from server session
            // If you don't have this endpoint yet, you can skip it—UI still works.
            try {
                const res = await fetch(API.contextUser, { credentials: "same-origin" });
                if (!res.ok) return;

                const ctx = await res.json();

                // Suggested shape: { ok:true, storedEmail:"...", subtitle:"..." }
                if (ctx && ctx.ok) {
                    if (ctx.subtitle) $("subtitle").textContent = String(ctx.subtitle);
                    if (ctx.storedEmail) $("inputUserId").value = String(ctx.storedEmail);
                }
            } catch (_) {
                // ignore
            }

            // Focus logic matches your current behavior
            setTimeout(() => {
                if ($("inputUserId").value) $("inputPassword").focus();
                else $("inputUserId").focus();
            }, 0);
        }

        async function doLogin() {
            if (state.busy) return;

            showError("");
            setStatus("", "");

            const v = validate();
            if (!v.ok) {
                showError(v.msg);
                return;
            }

            setBusy(true);
            setStatus("Signing in…", "info");

            // Contract (recommended):
            // request: { userId, password }
            // response: { ok, message?, nextUrl? }
            const out = await apiPostJson(API.login, { userId: v.userId, password: v.password });

            setBusy(false);

            if (out && out.ok) {
                showError("");
                setStatus(out.message || "Signed in.", "success");

                // Redirect immediately (or small delay if you want the success flash)
                const next = (out && out.nextUrl) ? String(out.nextUrl) : resolveRoute(BOOT.returnAction);
                window.location.assign(next);

            } else {
                const msg = (out && out.message) ? String(out.message) : "Invalid credentials";
                showError(msg);
                setStatus(msg, "error");
            }
        }

        async function doCancel() {
            if (state.busy) return;

            try {
                // If logout endpoint exists, clear server session
                await fetch(API.logout, { method: "POST", credentials: "same-origin" });
            } catch (_) { /* ignore */ }

            window.location.assign(resolveRoute(BOOT.cancelAction));
        }

        function wire() {
            $("btnCancel").addEventListener("click", doCancel);

            $("btnPwdToggle").addEventListener("click", () => {
                if (state.busy) return;

                const input = $("inputPassword");
                const willShow = (input.type === "password");
                input.type = willShow ? "text" : "password";

                $("icoEye").classList.toggle("hidden", !willShow);
                $("icoEyeOff").classList.toggle("hidden", willShow);

                const label = willShow ? "Hide password" : "Show password";
                $("btnPwdToggle").setAttribute("aria-label", label);
                $("btnPwdToggle").setAttribute("title", label);
            });

            $("btnLogin").addEventListener("click", doLogin);

            $("inputPassword").addEventListener("keydown", (e) => {
                if (e.key === "Enter") $("btnLogin").click();
            });
        }

        // Boot
        wire();
        initFromServer();
    </script>


</body>

</html>